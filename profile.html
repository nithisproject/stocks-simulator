<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profile</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:"Segoe UI",Arial,sans-serif;
}

body{
background:#f4f6f9;
color:#1f2937;
}

/* HEADER */
header{
background:#ffffff;
height:60px;
display:flex;
align-items:center;
justify-content:space-between;
padding:0 25px;
border-bottom:1px solid #e5e7eb;
box-shadow:0 2px 8px rgba(0,0,0,0.05);
}

.logo{
color:#2563eb;
font-weight:700;
font-size:1.2rem;
}

.header-nav a{
text-decoration:none;
color:#374151;
font-weight:500;
margin-right:15px;
transition:.2s;
}

.header-nav a:hover{
color:#2563eb;
}

.logout-btn{
padding:6px 12px;
background:#dc2626;
color:white;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:600;
}

.logout-btn:hover{
background:#b91c1c;
}

/* LAYOUT */
#layout{
display:grid;
grid-template-columns:220px 1fr;
height:calc(100vh - 60px);
}

/* SIDEBAR */
#sidebar{
background:#ffffff;
border-right:1px solid #e5e7eb;
padding:15px;
}

.navBtn{
display:block;
padding:10px 12px;
margin-bottom:10px;
background:#f9fafb;
border-radius:8px;
text-decoration:none;
color:#374151;
transition:.25s;
font-weight:500;
}

.navBtn:hover{
background:#e0e7ff;
color:#1d4ed8;
}

/* MAIN CONTENT */
.main{
padding:40px;
overflow:auto;
}

h2{
color:#2563eb;
margin-bottom:25px;
font-weight:700;
}

.card{
background:#ffffff;
border:1px solid #e5e7eb;
border-radius:12px;
padding:25px;
margin-bottom:25px;
box-shadow:0 6px 18px rgba(0,0,0,0.05);
transition:.25s;
}

.card:hover{
transform:translateY(-4px);
box-shadow:0 12px 28px rgba(0,0,0,0.08);
}

.balanceBox{
font-size:32px;
font-weight:700;
color:#2563eb;
margin-top:10px;
}

label{
display:block;
margin-top:14px;
margin-bottom:6px;
color:#6b7280;
font-weight:500;
}

input{
width:100%;
padding:12px;
border-radius:10px;
border:1px solid #d1d5db;
background:#ffffff;
color:#111827;
outline:none;
transition:.25s;
}

input:focus{
border-color:#2563eb;
box-shadow:0 0 0 3px rgba(37,99,235,0.2);
}

button{
padding:12px 20px;
border:none;
border-radius:10px;
cursor:pointer;
font-weight:600;
margin-top:15px;
transition:.2s;
}

button:hover{
transform:translateY(-2px);
box-shadow:0 6px 16px rgba(0,0,0,0.15);
}

.primary{
background:#2563eb;
color:white;
}

.depositBtn{
background:#16a34a;
color:white;
}

.withdrawBtn{
background:#dc2626;
color:white;
}

.row{
display:flex;
gap:15px;
margin-top:15px;
}

.row input{
flex:1;
}

.success{
color:#16a34a;
margin-top:12px;
font-weight:500;
}

.error{
color:#dc2626;
margin-top:12px;
font-weight:500;
}
</style>
</head>

<body>

<header>
<div style="display:flex;align-items:center;">
<div class="logo">TRADING SIMULATOR</div>

</div>

<button class="logout-btn" onclick="logout()">Logout</button>
</header>

<div id="layout">

<div id="sidebar">
<a href="trade.html" class="navBtn">ðŸ“ˆ Trade</a>
<a href="profile.html" class="navBtn">ðŸ‘¤ Profile</a>
<a href="history.html" class="navBtn">ðŸ“œ History</a>
</div>

<div class="main">

<h2>Profile Dashboard</h2>

<div class="card">
  <div>Current Balance</div>
  <div class="balanceBox">â‚¹<span id="bal">0</span></div>
</div>

<div class="card">
  <h3>Account Details</h3>

  <label>Name</label>
  <input id="name">

  <label>Email</label>
  <input id="email">

  <label>Password</label>
  <input id="password" type="password">

  <button class="primary" onclick="updateProfile()">Update Profile</button>
  <div id="profileMsg"></div>
</div>

<div class="card">
  <h3>Wallet</h3>

  <div class="row">
    <input type="number" id="amount" placeholder="Enter Amount">
  </div>

  <div class="row">
    <button class="depositBtn" onclick="deposit()">Deposit</button>
    <button class="withdrawBtn" onclick="withdraw()">Withdraw</button>
  </div>

  <div id="walletMsg"></div>
</div>

</div>
</div>

<script>
const supabaseClient = window.supabase.createClient(
  "https://nxwcekpehqmdkelyrzqf.supabase.co",
  "sb_publishable_bjF_z3_ZDaKRTByS4jWfyA_6U12XYtu"
);

let userId = sessionStorage.getItem('userId');
let balance = 0;

if(!userId){
  alert("User not logged in");
  window.location.href="index.html";
}

function logout(){
sessionStorage.removeItem("userId");
window.location.href="index.html";
}

async function loadProfile(){
  const { data: user } = await supabaseClient
    .from('users')
    .select('*')
    .eq('id', userId)
    .single();

  const { data: fund } = await supabaseClient
    .from('funds')
    .select('*')
    .eq('user_id', userId)
    .single();

  if(user){
    name.value = user.name || '';
    email.value = user.email || '';
  }

  if(fund){
    balance = parseFloat(fund.balance) || 0;
    bal.innerText = balance.toFixed(2);
  }
}
loadProfile();

async function updateProfile(){
  const { error } = await supabaseClient
    .from('users')
    .update({
      name: name.value,
      email: email.value,
      password: password.value
    })
    .eq('id', userId);

  profileMsg.className = error ? "error" : "success";
  profileMsg.innerText = error ? "Update failed!" : "Profile updated successfully!";
}

async function deposit(){
  const amt = parseFloat(amount.value);
  if(!amt || amt<=0) return walletMsg.innerText="Invalid amount";

  balance += amt;

  await supabaseClient.from('funds')
    .update({ balance })
    .eq('user_id', userId);

  bal.innerText = balance.toFixed(2);
  walletMsg.className="success";
  walletMsg.innerText="Deposit successful!";
}

async function withdraw(){
  const amt = parseFloat(amount.value);
  if(!amt || amt<=0 || amt>balance) return walletMsg.innerText="Invalid amount";

  balance -= amt;

  await supabaseClient.from('funds')
    .update({ balance })
    .eq('user_id', userId);

  bal.innerText = balance.toFixed(2);
  walletMsg.className="success";
  walletMsg.innerText="Withdraw successful!";
}
</script>

</body>
</html>