<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trading History</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<style>
body{background:#0b0e11;color:#fff;font-family:"Segoe UI",Arial,sans-serif;padding:20px}
h2{color:#ff9800}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{border:1px solid #333;padding:8px;text-align:center;}
th{background:#151b23;color:#00e5ff;}
</style>
</head>
<body>
<h2>Trading History</h2>
<table>
<thead><tr><th>Type</th><th>Qty</th><th>Price</th><th>PnL</th><th>Date</th></tr></thead>
<tbody id="historyBody"></tbody>
</table>

<script>
const supabaseUrl = 'https://mpcvctbrinkzdohjrpth.supabase.co';
const supabaseKey = 'sb_publishable_toAs6cvoLBqIpDEzVzabuA_KDUtaUvl';
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

let userId = localStorage.getItem('userId');

async function loadHistory(){
  const { data, error } = await supabaseClient.from('transactions').select('*').eq('user_id', userId).order('created_at',{ascending:false});
  if(data){
    const tbody = document.getElementById('historyBody');
    tbody.innerHTML = '';
    data.forEach(tr => {
      tbody.innerHTML += `<tr><td>${tr.type}</td><td>${tr.qty||'-'}</td><td>${tr.price||'-'}</td><td>${tr.pnl||0}</td><td>${new Date(tr.created_at).toLocaleString()}</td></tr>`;
    });
  }
}

loadHistory();
</script>
</body>
</html>